{% extends "admin/base_site.html" %}
{% block content %}

{% block css_files %}
    <style>
    .editor {
      display: inline-flex;
      gap: 10px;
      font-family: monospace;
      line-height: 21px;
      background: #282a3a;
      border-radius: 2px;
      padding: 20px 10px;
        max-height: 500px;
        overflow-y: scroll;
    }

    form {
        max-height: 500px;
        max-lines: 20;
    }

    textarea {
      line-height: 21px;
      overflow-y: scroll;
      padding: 0;
      border: 0;
      background: #282a3a;
      color: #FFF;
      min-width: 500px;
      outline: none;
      resize: none;
        max-height: 500px;
    }

    .line-numbers {
      width: 20px;
      text-align: right;
        max-height: 500px;
        max-lines: 20;
        overflow-y: scroll;
        resize: none;
    }

    .line-numbers span {
      counter-increment: linenumber;
        max-lines: 20;
        overflow-y: scroll;
    }

    .line-numbers span::before {
      content: counter(linenumber);
      display: block;
      color: #506882;
        max-lines: 20;
        overflow-y: scroll;
    }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
{% endblock %}

    <form action="addUserProfile/" method="POST">
    {% csrf_token %}
      <!-- Message input -->
      <div class="editor">
          <div class="line-numbers">
                <span></span>
            </div>
        <textarea spellcheck="false" name="formTextArea" id="formTextArea" required >{% if text %}{{ text }}{% endif %}</textarea> <!--class="form-control"-->
        <label class="form-label" for="formTextArea"></label>
      </div>

      <!-- Checkbox -->
      <div class="form-check d-flex justify-content-center mb-4">
        <input class="form-check-input me-2" type="checkbox" value="" name="formCheckBox" id="formCheckBox" checked />
        <label class="form-check-label" for="formCheckBox">
          Create models if not exist
        </label>
      </div>

      <!-- Submit button -->
        <div class="form-check d-flex justify-content-center mb-4">

        <button type="submit" class="btn btn-primary btn-block mb-4" name="createButton" value="create">
            Create UserProfile
        </button>

        <button type="submit" class="btn btn-primary btn-block mb-4" formaction="" name="typeCheckButton" value="check">

            TypeCheck
        </button>
        </div>
    </form>

    <div id="team"></div>

    <script>
        const textarea = document.querySelector('textarea')
        const lineNumbers = document.querySelector('.line-numbers')

        textarea.addEventListener('keyup', event => {
          const numberOfLines = event.target.value.split('\n').length

          lineNumbers.innerHTML = Array(numberOfLines)
            .fill('<span></span>')
            .join('')
        })

        textarea.addEventListener('keydown', event => {
          if (event.key === 'Tab') {
            const start = textarea.selectionStart
            const end = textarea.selectionEnd

            textarea.value = textarea.value.substring(0, start) + '\t' + textarea.value.substring(end)

            event.preventDefault()
          }
        })
    </script>

    <script>
        window.onload = function (){
            try {
                if (Boolean({{ showTable }})) {
                    myFunction();
                    paintMissingSpaces();
                }

            } catch (e){
                console.error(e);
            }
        }

        //const textarea = document.querySelector('textarea');

        textarea.addEventListener('keyup', event => {
            //myFunction();
            inputText = document.getElementById("formTextArea").value;
            if (inputText == null || inputText === '') {
                    alert('empty or contains a new line');
            }
        })

        function paintMissingSpaces(){
            var table = document.getElementById('userProfileTable');

            var missingSpacesRows = {{ missingSpacesRows }};
            var missingSpacesCols = {{ missingSpacesCols }};
            if (missingSpacesRows === 'None' || missingSpacesCols === 'None'){
                return;
            }
            console.log(missingSpacesRows)

            for (let i = 0; i < missingSpacesCols.length; i++) {
                table.rows[missingSpacesRows[i]+1].cells[missingSpacesCols[i]+1].style.backgroundColor = '#ff5454';
            }

        }

        function myFunction() {
            //var errors = {{  errors }};

          var tbl = "<table class='table table-sm table-responsive table-bordered table-striped' id='userProfileTable'><tbody>"
          var lines = document.getElementById("formTextArea").value.split("\n");
          for (var i = 0; i < lines.length; i++) {
              if (i!=0)
                tbl = tbl + "<tr>" +"<th scope="+'"row">'+i +"</th>"
              else
                  tbl = tbl + "<tr>" +"<th scope="+'"row">'+"#" +"</th>"
            var items = lines[i].split(",");
            for (var j = 0; j < items.length; j++) {
              tbl = tbl + "<td>" + items[j] + "</td>";
            }
            tbl = tbl + "</tr>";
          }
          tbl = tbl + "</tbody></table>";
          var divTable = document.getElementById('team');
          //console.log(tbl);
            //var x = tbl.rows[0]?.cells;
            //x[0].innerHTML = "NEW CONTENT";
          divTable.innerHTML = tbl;

        }
        </script>
{% endblock %}